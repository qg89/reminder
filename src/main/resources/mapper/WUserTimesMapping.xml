<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.q.reminder.reminder.mapper.WUserTimesMapping">
    <select id="listByTable" resultType="java.util.Map">
        SELECT p.p_name    projectName,
               u.user_name userName,
               ut.houses,
               ut.`day`,
                CASE ut.time_type WHEN '0' THEN '正常' ELSE 'BUG' END AS timeType
        FROM `w_user_times` ut
             LEFT JOIN r_redmine_user_info u ON ut.user_id = u.assignee_id
             LEFT JOIN r_project_info p ON ut.p_id = p.id AND u.redmine_type = p.redmine_type
        WHERE p.is_delete = 0
        <choose>
            <when test="dayType == 2">
                AND ut.day = #{day}
            </when>
            <otherwise>
                AND DATE_FORMAT(ut.day,'%Y-%m') =  #{day}
            </otherwise>
        </choose>
    </select>
</mapper>

