<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.q.reminder.reminder.mapper.GroupInfoMapping">
    <select id="listByProject" resultType="com.q.reminder.reminder.vo.ChatProjectVo">
        SELECT
            p.p_id pId,
            f.chat_id chatId,
            f.reminder_none reminderNone,
            f.reminder_title reminderTitle,
            fm.member_id memberId,
            fm.`name` NAME,
            r.assignee_id assigneeId,
            p.p_key pKey
        FROM
            `r_project_info` p
            LEFT JOIN group_project gp ON p.p_id = gp.p_id
            LEFT JOIN fs_group_info f ON gp.chat_id = f.chat_id
            LEFT JOIN r_coverity c ON c.r_project_id = p.id
            LEFT JOIN r_redmine_user_info r ON r.assignee_id = c.r_assignee_id
            LEFT JOIN fs_user_member_info fm ON fm.`name` = r.assignee_name
        WHERE
            p.is_delete = '0'
            AND f.is_delete = '0'
            AND f.send_type = '3'
        <if test="pKey != null and pKey != ''">
            AND p.p_key = #{pKey}
        </if>
    </select>
</mapper>
