<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.q.reminder.reminder.mapper.CoverityMapping">
    <select id="queryByProject" resultType="com.q.reminder.reminder.vo.CoverityAndRedmineSaveTaskVo">
        SELECT
            c.c_project_id AS coverityProjectId,
            c.c_view_id AS viewId,
            c.r_project_id AS redmineProjectId,
            c.r_parent_id AS parentId,
            c.r_assignee_id AS assigneeId,
            f.member_id AS receiveId,
            p.redmine_url AS redmineUrl,
            p.pm_key AS apiAccessKey,
            p.project_short_name AS redmineProjectName,
            f.member_id memberId,
            f.`name`
        FROM
            r_coverity c
            LEFT JOIN r_project_info p ON c.r_project_id = p.p_id
            LEFT JOIN r_redmine_user_info r ON c.r_assignee_id = r.assignee_id AND u.redmine_type = p.redmine_type
            LEFT JOIN fs_user_member_info f ON r.assignee_name = f.`name`
        WHERE
            c.create_task = '0'
            AND c.is_delete = '0'
            AND p.is_delete = '0'
        <if test="pKey != null and pKey != ''">
            AND p.p_key = #{pKey}
        </if>
    </select>
</mapper>
