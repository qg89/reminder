<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.q.reminder.reminder.mapper.UserMapping">
    <select id="queryUserGroupList" resultType="com.q.reminder.reminder.vo.SendUserByGroupVo">
        SELECT
            ug.member_id AS memberId,
            ui.`name` AS `name`,
            gi.chat_id AS chatId,
            gi.`name` chatName,
            r.assignee_id assigneeId,
            gi.reminder_none AS reminderNone,
            CONCAT( ' (', CURDATE(), ')', gi.reminder_title ) AS reminderTitle
        FROM
            fs_user_member_info ui
            LEFT JOIN `fs_user_group` ug ON ui.member_id = ug.member_id
            LEFT JOIN fs_group_info gi ON gi.chat_id = ug.chat_id
            LEFT JOIN r_redmine_user_info r ON REPLACE ( r.user_name, ' ', '' ) = ui.`name`
        WHERE
            gi.send_type = 0
          AND ui.is_delete = 0
          AND ui.resign = '0'
          AND ui.`name` IS NOT NULL
          AND r.assignee_id IS NOT NULL
    </select>
</mapper>
